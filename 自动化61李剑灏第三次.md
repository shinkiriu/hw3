# hw3
###第三次作业

###Project3:直方图图像增强；
----------------------------------------------------------
共8幅经变亮或者变暗处理的源图像；

要求：
1.把附件图像的直方图画出； 
2.把所有图像进行直方图均衡；输出均衡后的图像和源图像进行比对；分析改善内容；
3.进一步把图像按照对源图像直方图的观察，各自自行指定不同源图像的直方图，进行直方图匹配，进行图像增强；
4.对elain和lena图像进行7*7的局部直方图增强；
5.利用直方图对图像elain和woman进行分割；

要求：按照作业报告格式提交报告,第三个单周二交作业。
另原始图像3幅：没有数字标号的图像。

------------------------------------------------------------
###第一题
   
分析：采用了批量读取图片的方式，将文件夹路径添加，获取所有的图片dir，然后将图片利用循环批量循环处理显示成直方图。同时需要注意用调色板将索引图像转换为灰度图像。

**运行结果
![]https://raw.githubusercontent.com/shinkiriu/hw3/master/citywall.fig
![]https://raw.githubusercontent.com/shinkiriu/hw3/master/citywall1.fig
![]https://raw.githubusercontent.com/shinkiriu/hw3/master/citywall2.fig
![]https://raw.githubusercontent.com/shinkiriu/hw3/master/elain.fig
![]https://raw.githubusercontent.com/shinkiriu/hw3/master/elain1.fig
![]https://raw.githubusercontent.com/shinkiriu/hw3/master/elain2.fig
![]https://raw.githubusercontent.com/shinkiriu/hw3/master/elain3.fig
![]https://raw.githubusercontent.com/shinkiriu/hw3/master/elain4.fig
![]https://raw.githubusercontent.com/shinkiriu/hw3/master/lena.fig
![]https://raw.githubusercontent.com/shinkiriu/hw3/master/lena1.fig
![]https://raw.githubusercontent.com/shinkiriu/hw3/master/lena2.fig
![]https://raw.githubusercontent.com/shinkiriu/hw3/master/lena3.fig
![]https://raw.githubusercontent.com/shinkiriu/hw3/master/lena4.fig
![]https://raw.githubusercontent.com/shinkiriu/hw3/master/woman.fig
![]https://raw.githubusercontent.com/shinkiriu/hw3/master/woman1.fig
![]https://raw.githubusercontent.com/shinkiriu/hw3/master/woman2.fig

------------------------------------------------------------
###第二题
   
分析：在第一题的基础上，调用matlab的均衡函数histeq，用于获取均衡后的直方图图像.

**运行结果**
https://raw.githubusercontent.com/shinkiriu/3.2/master/citywall.fig
https://raw.githubusercontent.com/shinkiriu/3.2/master/citywall1.fig
https://raw.githubusercontent.com/shinkiriu/3.2/master/citywall2.fig
https://raw.githubusercontent.com/shinkiriu/3.2/master/elain.fig
https://raw.githubusercontent.com/shinkiriu/3.2/master/elain1.fig
https://raw.githubusercontent.com/shinkiriu/3.2/master/elain2.fig
https://raw.githubusercontent.com/shinkiriu/3.2/master/elain3.fig
https://raw.githubusercontent.com/shinkiriu/3.2/master/elain4.fig
https://raw.githubusercontent.com/shinkiriu/3.2/master/lena.fig
https://raw.githubusercontent.com/shinkiriu/3.2/master/lena1.fig
https://raw.githubusercontent.com/shinkiriu/3.2/master/lena2.fig
https://raw.githubusercontent.com/shinkiriu/3.2/master/lena3.fig
https://raw.githubusercontent.com/shinkiriu/3.2/master/lena4.fig
https://raw.githubusercontent.com/shinkiriu/3.2/master/woman.fig
https://raw.githubusercontent.com/shinkiriu/3.2/master/woman1.fig
https://raw.githubusercontent.com/shinkiriu/3.2/master/woman2.fig


------------------------------------------------------------
###第三题

分析：直方图匹配又称为直方图规定化，是指将一幅图像的直方图变成规定形状的直方图而进行的图像增强方法。T1, T2分别为输入图像，模板直方图的均衡化后得到的变换函数,构建T1,T2的关系得到T3，即最后的转换矩阵。


**运行结果**



------------------------------------------------------------
###第四题

分析：先构筑一个7*7的模板，利用循环实现7*7区域的匹配，得到的归一化直方图均值为新图像矩阵的对应像素点灰度值


**运行结果**


------------------------------------------------------------
###第五题

分析：计算图像直方图的均值，选取均值的0.9倍作为阈值，低于阈值的取0，其余不变，将处理后的直方图再做一次均衡处理，得到的即为结果的图像


**运行结果**




-------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------
###源代码
-------------------------------------第一题------------------------------
clc;close all;
file_path='C:\Users\msi\Desktop\第三次作业\第3-次作业\' ;
files = dir(fullfile(file_path,'*.bmp'));%获取该文件夹中所有bmp格式的图像 ?
img_num = length(files);%获取图像总数量?
if img_num > 0 %有满足条件的图像 ?
for i = 1:img_num %逐一读取图像 ??
    [datas,map] = imread(strcat(file_path,files(i).name));%文件所在路径
    Img=ind2gray(datas,map);    
    
    %name=files(i).name;
    figure
    subplot(2,1,1)
    imshow(Img)    %显示原图
    title(files(i).name);
    subplot(2,1,2)
    imhist(Img)   %显示直方图
    title(strcat(files(i).name,'直方图'));
end
end

-------------------------------------第二题------------------------------
clc;
file_path='C:\Users\msi\Desktop\第三次作业\第3-次作业\' ;
files = dir(fullfile(file_path,'*.bmp'));%获取该文件夹中所有bmp格式的图像 ?

img_num = length(files);%获取图像总数量?
if img_num > 0 %有满足条件的图像 ?
for i = 1:img_num %逐一读取图像 ??
   [datas,map] = imread(strcat(file_path,files(i).name));%文件所在路径
    Img=ind2gray(datas,map);
    %name=files(i).name;
    figure
    subplot(2,2,1)
    imshow(Img)    %显示原图
    title(files(i).name);
    subplot(2,2,2)
    imhist(Img)   %显示直方图
    title(strcat(files(i).name,'直方图'));
    Imgjun=histeq(Img);
    subplot(2,2,3)
    imshow(Imgjun)    %显示均衡后原图
    title(strcat(files(i).name,'均衡后'));
    subplot(2,2,4)
    imhist(Imgjun)    %显示均衡后直方图
    title(strcat(files(i).name,'均衡后直方图'));   
end
end
pause
close all;
-------------------------------------第三题------------------------------
%function [image_hist1,image_hist2,image_out, T3] = histmatching(image_in, image_goal)
% 直方图匹配（规定化）函数
% 输入为需要进行直方图匹配的灰度图像，模板直方图
% 输出为直方图匹配后的灰度图像，进行变换的向量。

% T1, T2分别为输入图像，模板直方图的均衡化后得到的变换函数
% T3为输入图像匹配模板直方图用到的变换向量
image_in=imread('citywall.bmp');

[datas,map] =imread('citywall2.bmp');%调色板读取图像
image_goal=ind2gray(datas,map);

[m, n] = size(image_in);
[image_hist1,T1]=histeq(image_in,255);%image_hist1为经过均衡化后的原图像
T1=round(255*T1);
[image_hist2,T2]=histeq(image_goal,255);%image_hist2为经过均衡化后的目标图像
T2=round(255*T2);

temp = zeros(256, 1);
T3 =T1;

for i = 1 : 256
    for j = 1 : 256
        temp(j) = abs(T1(i) - T2(j));
    end
    [~, B] = min(temp);
    T3(i) = uint8(B - 1);%T3为得到的目标匹配函数
end

% 根据T3转换输入图像的值
for i = 1 : m
    for j = 1 : n
        image_out(i, j) = T3(uint8(image_in(i, j)) + 1);
    end
end

figure
subplot(2,3,1)
imshow(image_in);
title('转换前的图像');
subplot(2,3,2)
imshow(image_goal);
title('目标图像')
subplot(2,3,3)
imshow(image_out);
title('输出图像')
subplot(2,3,4)
imhist(image_in);
title('转换前的直方图');
subplot(2,3,5)
imhist(image_goal);
title('目标直方图')
subplot(2,3,6)
imhist(image_out);
title('输出图像')
%end

-------------------------------------第四题------------------------------

file_path='C:\Users\msi\Desktop\第三次作业\第3-次作业\' ;
image=imread(strcat(file_path,'elain.bmp'));
[M N] = size(image);
n=7;
a(1:n,1:n)=1;%设置7*7模板
x1=double(image);
x2=image;
for i = 1:512-n+1
    for j = 512-n+1
        m = x1(i:i+n-1,j:j+n-1).*a(1:n,1:n); %取出x1中从(i,j)开始的n行n列元素与模板相乘
        m = uint8(m);
        k = histeq(m);%对块图进行直方图均衡
        x3 = double(k);
        x2(i+(n-1)/2,j+(n-1)/2) = x3((n+1)/2,(n+1)/2); %将均衡后中心点的像素值赋给原图对应点的元素
    end
end
figure
subplot(2,1,1)
imshow(image);
title('原图像');
subplot(2,1,2)
imshow(x2);
title('7*7增强后图像');


-------------------------------------第五题------------------------------

file_path='C:\Users\msi\Desktop\第三次作业\第3-次作业\' ;
image=imread(strcat(file_path,'elain.bmp'));
hist=imhist(image);
[m,n]=size(image);
hist=255*hist/(m*n);
mean=0;
for i=1:256  
    mean=hist(i)*i/255+mean;%mean为平均频率
end
Tist=hist;
for i=1:256  
    if i<0.9*mean    %选取0.5倍为阈值分割点 
         Tist(i)=0;
    end
end
image_goal=histeq(image,Tist);%T为分割后的变换函数
figure
subplot(2,2,1)
imshow(image);
title('分割前图像');
subplot(2,2,2)
imshow(image_goal);
title('分割后图像');
subplot(2,2,3)
imhist(hist);
title('分割前直方图');
subplot(2,2,4)
imhist(Tist);
title('分割后直方图');
